<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
/* @var $this Mage_Reports_Block_Product_Viewed */

require_once( Mage::getBaseDir('base') . '/app/code/local/NPS/BetterLayerNavigation/Helper/product.drop.class.php');
$nps_prdctrl = new productDrop;
?>
<?php if ($_products = $this->getRecentlyViewedProducts()): ?>
<div class="block block-list block-viewed">
    <div class="block-title">
        <strong><span><?php echo $this->__('Recently Viewed Products') ?></span></strong>
    </div>
    <div class="block-content">
        <ol id="recently-viewed-items">
        <?php foreach ($_products as $_item): ?>
            <li class="item">
                <?php
                if( $nps_prdctrl->getChildOptionTypeID( $_item->getId() ) ){
                    $nps_args = array(
                        'npsf'=> $nps_prdctrl->getChildOptionTypeID( $_item->getId() )[0]['option_type_id'],
                        );
                    $_parentprdURL = $nps_prdctrl->getContainerProductURL( $_item->getId(), $nps_args );
                } else {
                    $_parentprdURL = $_item->getProductUrl();
                }

                ?>
                <span class="recently-viewed-link">
                    <p class="product-name"><a class="tooltip" title="<?php echo $_item->getName() ?>" href="<?php echo $_parentprdURL ?>"><?php echo $_item->getAttributeText('manufacturer') ?> <?php echo $_item->getSKU() ?></a></p>
                </span>
                <span class="recently-viewiwed-thumb">
                    <a class="tooltip" title="<?php echo $_item->getName() ?>" href="<?php echo $_parentprdURL ?>"><img src="<?php echo $_item->getImageUrl() ?>"></a>
                </span>
            </li>
        <?php endforeach; ?>
        </ol>
        <script type="text/javascript">decorateList('recently-viewed-items');</script>
    </div>
</div>
<?php endif; ?>
