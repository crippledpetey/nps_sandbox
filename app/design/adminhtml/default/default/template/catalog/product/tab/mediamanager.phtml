<?php
/**
* Magento
*
* NOTICE OF LICENSE
*
* This source file is subject to the Academic Free License (AFL 3.0)
* that is bundled with this package in the file LICENSE_AFL.txt.
* It is also available through the world-wide-web at this URL:
* http://opensource.org/licenses/afl-3.0.php
* If you did not receive a copy of the license and are unable to
* obtain it through the world-wide-web, please send an email
* to license@magentocommerce.com so we can send you a copy immediately.
*
* DISCLAIMER
*
* Do not edit or add to this file if you wish to upgrade Magento to newer
* versions in the future. If you wish to customize Magento for your
* needs please refer to http://www.magentocommerce.com for more information.
*
* @category    design
* @package     default_default
* @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
* @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
*/
$_mmProduct = $this->getProduct();
$prd_id = null;
$_mmImages = array();
$_mmImageCount = 0;
if( !empty( $_mmProduct->getID() ) ){
	$prd_id = $_mmProduct->getID();
	$_mmImages = $this->_getImages( $prd_id );
	$_mmImageCount = count( $_mmImages );

}

//set array to show friendly values
$friendly_conversion = array(
	'app_shot'=>'Application Shot',
	'prd_shot'=>'Product Shot',
	);

?>
<div class="entry-edit">
	<div class="entry-edit-head">
		<h4 class="icon-head head-edit-form fieldset-legend"><?php echo Mage::helper('catalog')->__('Product Image Upload Manager') ?></h4>
	</div>
	<div class="fieldset" id="grop_fields">
		<div id="media_gallery_content">
			<ul class="messages">
				<li class="notice-msg hidden">
					<ul>
						<li>Image type and information need to be specified for each store view.</li>
					</ul>
				</li>
			</ul>
			<div class="grid">
				<table id="nps-media-gallery-table">
					<thead>
						<tr>
							<th>ID</th>
							<th>Preview</th>
							<th>Image Type</th>
							<th>Display Order</th>
							<th>Remove</th>
						</tr>
					</thead>
					<tbody>
						<?php if (empty( $_mmImages ) ):?>
							<tr><td colspan="5">No Images Have Been Added</td></tr>
						<?php else: ?>
							<?php foreach( $_mmImages as $img ): ?>
							<tr>
								<td><?php echo $img['id'] ?></td>
								<?php 
									//setup source information
									$img_src_base = '//images.needplumbingsupplies.com/catalog/';
									if( $img['type'] == 'app_shot' ){
										$image_url .= $img_src_base . 'product_alt/';
									} else {
										$image_url .= $img_src_base . 'product/';
									}
								?>
								<td><img src="<?php echo $image_url . $_mmProduct->getAttributeText('manufacturer') . '/65x65/' . $img['file_name'] ?>"></td>
								<td><?php echo $friendly_conversion[ $img['type'] ] ?></td>
								<td><?php echo $img['order'] ?></td>
								<td></td>
							</tr>
							<?php endforeach; ?>
						<?php endif; ?>
						<tr>
							<form name="nps-media-gallery-upload-form" method="post" enctype="multipart/form-data">
							<td colspan="2">								
								<input type="file" name="nps-media-manager-upload-input" id="nps-media-manager-upload-input">
							</td>
							<td>
								Image Type
								<select name="nps-media-gallery-image-type">
									<option value="prd_shot">Product Image</option>
									<option value="app_shot">Application Image</option>
								</select>								
							</td>
							<td>
								Display Order
								<input type="number" name="nps-media-manager-image-order" min="0" max="<?php echo $_mmImageCount + 1 ?>" id="nps-media-manager-image-order" value="<?php echo $_mmImageCount + 1 ?>">
							</td>
							<td>
								<input type="submit" value="Upload Image">
								<input type="hidden" name="MAX_FILE_SIZE" value="500000" />
								<input type="hidden" name="nps-media-gallery-product-id" value="<?php echo $prd_id?>">
								<input type="hidden" name="nps-media-gallery-product-sku" value="<?php echo $_mmProduct->getSku() ?>">
								<input type="hidden" name="nps-media-gallery-product-manu" value="<?php echo $_mmProduct->getAttributeText('manufacturer') ?>">
								<input type="hidden" name="nps-media-gallery-start-count" value="<?php echo count($_mmImages) +1 ?>">
								<input type="hidden" name="nps_function" value="nps-media-manager-upload">
								<input type="hidden" name="nps-media-gallery-updated" value="false">
								<input type="hidden" name="form_key" value="<?php echo Mage::getSingleton('core/session')->getFormKey() ?>">
							</td>
							</form>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>